setup:
  addons:
    - plan: heroku-postgresql
      as: DATABASE
  config:
build:
  docker:
    web: Dockerfile
    worker: worker/Dockerfile
  config:
    APP_NAME: TaskManager
    APP_ENV: local
    APP_KEY: base64:jLOSaC2Z5KsfMX0pdiAzZsThknUwbseQZbxGrWaMeH4=
    APP_DEBUG: true
    APP_URL: http://localhost

    LOG_CHANNEL: stack

    DB_CONNECTION: mysql
    DB_HOST: db
    DB_PORT: 3306
    DB_DATABASE: task_manager
    DB_USERNAME: develop
    DB_PASSWORD: develop
release:
  command:
    - ./deployment-tasks.sh
  image: worker
run:
  web: bundle exec puma -C config/puma.rb
  worker: python myworker.py
  asset-syncer:
    command:
      - python asset-syncer.py
    image: worker